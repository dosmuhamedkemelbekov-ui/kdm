<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>“ö“±—Ä—ã–ª—ã—Ç–∞–π App</title>
    <style>
        :root {
            --primary: #007AFF;
            --bg: #F2F2F7;
            --card-bg: #FFFFFF;
            --text-main: #1C1C1E;
            --text-secondary: #8E8E93;
            --border: #E5E5EA;
            --shadow: 0 4px 12px rgba(0,0,0,0.05);
            --success: #34C759;
            --warning: #FF9500;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text-main); line-height: 1.4; }

        .container { padding: 16px; width: 100%; max-width: 500px; margin: 0 auto; }
        
        /* Auth */
        .auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 2000; overflow-y: auto; padding: 40px 24px; }
        .auth-card { background: var(--card-bg); padding: 24px; border-radius: 24px; box-shadow: var(--shadow); }
        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; padding-left: 4px; }
        input { width: 100%; padding: 14px; border-radius: 14px; border: 1px solid var(--border); font-size: 16px; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--primary); }

        /* Navigation */
        nav { position: fixed; bottom: 0; left: 0; right: 0; height: 84px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-top: 1px solid var(--border); display: flex; justify-content: space-around; z-index: 1000; padding-bottom: 20px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: var(--text-secondary); font-size: 10px; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 22px; margin-bottom: 2px; }

        /* Components */
        header { padding: 44px 16px 12px; background: white; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        header h1 { font-size: 20px; margin: 0; color: var(--primary); }
        
        .card { background: var(--card-bg); border-radius: 18px; padding: 16px; margin-bottom: 16px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.02); }
        .btn { width: 100%; padding: 14px; border-radius: 14px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; background: var(--primary); color: white; transition: 0.2s; }
        .btn:active { opacity: 0.7; transform: scale(0.98); }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); margin-top: 8px; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
        .stat-item { background: white; padding: 16px; border-radius: 16px; text-align: center; box-shadow: var(--shadow); }
        .stat-val { font-size: 22px; font-weight: 800; color: var(--primary); display: block; }
        .stat-lab { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; }

        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .task-item:last-child { border-bottom: none; }
        .task-info b { display: block; font-size: 15px; }
        .task-info span { font-size: 12px; color: var(--text-secondary); }
        .points-badge { background: #E1F0FF; color: var(--primary); padding: 4px 8px; border-radius: 8px; font-weight: 700; font-size: 13px; }

        .hidden { display: none !important; }
        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 14px; z-index: 5000; display: none; text-align: center; }
    </style>
</head>
<body>

    <div id="toast"></div>

    <!-- Auth -->
    <div id="auth-screen" class="auth-screen">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 30px; font-size: 28px;">“ö“∞–†–´–õ–¢–ê–ô</h1>
            <div id="login-box" class="auth-card">
                <h2>–í—Ö–æ–¥</h2>
                <div class="input-group"><label>–ù–∏–∫–Ω–µ–π–º</label><input type="text" id="login-id" placeholder="–¢–≤–æ–µ –∏–º—è"></div>
                <div class="input-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
                <button class="btn" onclick="auth.login()">–í–æ–π—Ç–∏</button>
                <button class="btn btn-outline" onclick="auth.toggle(true)">–£ –º–µ–Ω—è –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            </div>
            <div id="register-box" class="auth-card hidden">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <div class="input-group"><label>–§–ò–û</label><input type="text" id="reg-name" placeholder="–ê–º–∞–Ω–∂–æ–ª –ò–±—Ä–∞–≥–∏–º"></div>
                <div class="input-group"><label>–ì—Ä—É–ø–ø–∞</label><input type="text" id="reg-group" placeholder="–ë–î 24-1"></div>
                <div class="input-group"><label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label><input type="text" id="reg-position" placeholder="–ù–∞–ø—Ä: –°–µ–∫—Ä–µ—Ç–∞—Ä—å"></div>
                <div class="input-group"><label>–ü—Ä–∏–¥—É–º–∞–π –ø–∞—Ä–æ–ª—å</label><input type="password" id="reg-pass" placeholder="–ú–∏–Ω–∏–º—É–º 6 –∑–Ω–∞–∫–æ–≤"></div>
                <button class="btn" onclick="auth.register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                <button class="btn btn-outline" onclick="auth.toggle(false)">–ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É</button>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div id="app" class="hidden">
        <header>
            <h1>“ö“∞–†–´–õ–¢–ê–ô</h1>
            <div onclick="ui.showProfile()" style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <span id="h-points" style="font-weight: 700; color: var(--primary);">0 üèÜ</span>
                <div id="h-avatar" style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px;">?</div>
            </div>
        </header>

        <main class="container" id="content"></main>

        <nav>
            <a href="#" class="nav-item active" onclick="ui.nav('home', this)"><span class="nav-icon">üè†</span><span>–ì–ª–∞–≤–Ω–∞—è</span></a>
            <a href="#" class="nav-item" onclick="ui.nav('tasks', this)"><span class="nav-icon">üéØ</span><span>–ó–∞–¥–∞—á–∏</span></a>
            <a href="#" class="nav-item" onclick="ui.nav('rating', this)"><span class="nav-icon">üèÜ</span><span>–†–µ–π—Ç–∏–Ω–≥</span></a>
            <a href="#" id="admin-tab" class="nav-item hidden" onclick="ui.nav('admin', this)"><span class="nav-icon">‚öôÔ∏è</span><span>–ê–¥–º–∏–Ω</span></a>
        </nav>
    </div>

    <script>
        const state = {
            users: [],
            participants: [],
            tasks: [
                {id: 1, title: '–£—á–∞—Å—Ç–∏–µ –≤ —Å–æ–±—Ä–∞–Ω–∏–∏', points: 10, desc: '–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–º —Å–±–æ—Ä–µ'},
                {id: 2, title: '–ü–æ–º–æ—â—å –∫–æ–ª–ª–µ–≥–µ', points: 15, desc: '–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏'},
                {id: 3, title: '–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞', points: 25, desc: '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∏–¥–µ–∏ –¥–ª—è –ø–∞—Ä–ª–∞–º–µ–Ω—Ç–∞'},
                {id: 4, title: '–û—Ç—á–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é', points: 10, desc: '–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–¥–∞—á–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏'}
            ],
            googleUrl: '–¢–í–û–ô_URL_–°–ö–†–ò–ü–¢–ê_–¢–£–¢', // –í–°–¢–ê–í–¨ –°–í–û–ô URL
            currentUser: null,

            save() {
                localStorage.setItem('q_data', JSON.stringify({
                    users: this.users, 
                    participants: this.participants
                }));
            },
            load() {
                const data = localStorage.getItem('q_data');
                if (data) {
                    const p = JSON.parse(data);
                    this.users = p.users || [];
                    this.participants = p.participants || [];
                }
                const sess = localStorage.getItem('q_sess');
                if (sess) this.currentUser = JSON.parse(sess);
            }
        };

        const auth = {
            toggle(isReg) {
                document.getElementById('login-box').classList.toggle('hidden', isReg);
                document.getElementById('register-box').classList.toggle('hidden', !isReg);
            },
            register() {
                const name = document.getElementById('reg-name').value;
                const group = document.getElementById('reg-group').value;
                const pos = document.getElementById('reg-position').value;
                const pass = document.getElementById('reg-pass').value;

                if (!name || pass.length < 6) return ui.toast('–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è (–ø–∞—Ä–æ–ª—å 6+)');

                const newUser = { id: Date.now(), name, group, position: pos, pass, points: 0, trust: 0 };
                state.users.push(newUser);
                state.participants.push(newUser);
                state.save();
                ui.toast('–£—Å–ø–µ—à–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏.');
                this.toggle(false);
            },
            login() {
                const id = document.getElementById('login-id').value;
                const pass = document.getElementById('login-pass').value;
                const u = state.users.find(x => x.name === id && x.pass === pass);
                if (u) {
                    state.currentUser = u;
                    localStorage.setItem('q_sess', JSON.stringify(u));
                    app.init();
                } else ui.toast('–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
            }
        };

        const ui = {
            current: 'home',
            toast(m) {
                const t = document.getElementById('toast');
                t.textContent = m; t.style.display = 'block';
                setTimeout(() => t.style.display = 'none', 2000);
            },
            nav(tab, el) {
                this.current = tab;
                document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
                if (el) el.classList.add('active');
                this.render();
            },
            render() {
                const main = document.getElementById('content');
                const u = state.participants.find(x => x.id === state.currentUser.id);
                document.getElementById('h-points').textContent = u.points + ' üèÜ';
                document.getElementById('h-avatar').textContent = u.name[0];

                if (this.current === 'home') {
                    main.innerHTML = `
                        <div class="card">
                            <h2 style="margin-top:0">–ü—Ä–∏–≤–µ—Ç, ${u.name}!</h2>
                            <p style="color:var(--text-secondary)">–¢–≤–æ—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å: <b>${u.position}</b></p>
                        </div>
                        <div class="stat-grid">
                            <div class="stat-item"><span class="stat-val">${u.points}</span><span class="stat-lab">–ë–∞–ª–ª—ã</span></div>
                            <div class="stat-item"><span class="stat-val">${u.trust}</span><span class="stat-lab">–î–æ–≤–µ—Ä–∏–µ</span></div>
                        </div>
                        <button class="btn btn-outline" onclick="logic.sync()">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ</button>
                    `;
                } else if (this.current === 'tasks') {
                    main.innerHTML = `<h2>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>` + state.tasks.map(t => `
                        <div class="card task-item">
                            <div class="task-info">
                                <b>${t.title}</b>
                                <span>${t.desc}</span>
                            </div>
                            <div class="points-badge">+${t.points}</div>
                        </div>
                    `).join('');
                } else if (this.current === 'rating') {
                    const sorted = [...state.participants].sort((a,b) => b.points - a.points);
                    main.innerHTML = `<h2>–†–µ–π—Ç–∏–Ω–≥</h2>` + sorted.map((p, i) => `
                        <div class="card task-item">
                            <div class="task-info">
                                <b>${i+1}. ${p.name}</b>
                                <span>${p.position}</span>
                            </div>
                            <div class="points-badge">${p.points}</div>
                        </div>
                    `).join('');
                } else if (this.current === 'admin') {
                    main.innerHTML = `
                        <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                        <div class="card">
                            <p>–ù–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã —É—á–∞—Å—Ç–Ω–∏–∫—É:</p>
                            <select id="adm-user" style="width:100%; padding:10px; border-radius:10px; margin-bottom:10px;">
                                ${state.participants.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                            </select>
                            <select id="adm-task" style="width:100%; padding:10px; border-radius:10px; margin-bottom:10px;">
                                ${state.tasks.map(t => `<option value="${t.points}">${t.title} (${t.points})</option>`).join('')}
                            </select>
                            <button class="btn" onclick="logic.addPoints()">–ù–∞—á–∏—Å–ª–∏—Ç—å</button>
                        </div>
                    `;
                }
            },
            showProfile() {
                if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                    localStorage.removeItem('q_sess');
                    location.reload();
                }
            }
        };

        const logic = {
            addPoints() {
                const uid = parseInt(document.getElementById('adm-user').value);
                const pts = parseInt(document.getElementById('adm-task').value);
                const u = state.participants.find(x => x.id === uid);
                u.points += pts;
                state.save();
                ui.toast('–ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã!');
                ui.render();
            },
            async sync() {
                if (!state.googleUrl || state.googleUrl.includes('–¢–í–û–ô_URL')) {
                    return ui.toast('–°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å URL —Å–∫—Ä–∏–ø—Ç–∞ –≤ –∫–æ–¥!');
                }
                ui.toast('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
                try {
                    const response = await fetch(state.googleUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify(state)
                    });
                    ui.toast('–ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—É.');
                } catch (e) {
                    ui.toast('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                }
            }
        };

        const app = {
            init() {
                state.load();
                if (state.currentUser) {
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    if (state.currentUser.name === '–ê–¥–º–∏–Ω' || state.currentUser.position.toLowerCase().includes('–ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å')) {
                        document.getElementById('admin-tab').classList.remove('hidden');
                    }
                    ui.render();
                }
            }
        };

        window.onload = app.init;
    </script>
</body>
</html>
